<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
        <title>January 2026 Boot Camp @ NubeEra </title>
        <!-- FAVICONS ICON -->
        <link rel="shortcut icon" type="image/png" href="/static/get/images/favicon.png">
        <link href="/static/get/vendor/jquery-nice-select/css/nice-select.css" rel="stylesheet">
        <link href="/static/get/vendor/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <!-- Style css -->
        <link href="/static/get/css/style.css" rel="stylesheet">
    </head>
    <body>
        <!--*******************
        Preloader start
    ********************-->
        <div id="preloader">
            <div class="lds-ripple">
                <div></div>
                <div></div>
            </div>
        </div>
        <div id="main-wrapper">
            <div class="container-fluid"></div>
            {% if request.user.profile_updated and request.user.utype == 'teacher'  %}
                {% include "teacher/layout/header.html" %}
                {% include "teacher/layout/sidebar.html" %}
            {% elif request.user.profile_updated and request.user.utype == 'student'  %}
                {% include "student/layout/header.html" %}
                {% include "student/layout/sidebar.html" %}
                {% elif request.user.profile_updated and request.user.utype == 'principle'  %}
                {% include "principle/layout/header.html" %}
                {% include "principle/layout/sidebar.html" %}
                {% elif request.user.profile_updated and request.user.utype == 'staff'  %}
                {% include "staff/layout/header.html" %}
                {% include "staff/layout/sidebar.html" %}
            {% endif %}
            <div class="content-body">
                {% if messages %}
    {% for message in messages %}
                <div class="alert alert-info" id="success-message">{{ message }}</div>
                {% endfor %}
{% endif %}
                <script>
    // Wait for the DOM to load
    document.addEventListener("DOMContentLoaded", function() {
        // Hide success message after 5 seconds
        var message = document.getElementById("success-message");
        if (message) {
            setTimeout(function() {
                message.style.display = 'none';
            }, 5000);
        }

        // Get first name, last name, and full name fields
        const firstNameField = document.getElementById('first_name');
        const lastNameField = document.getElementById('last_name');
        const fullNameField = document.getElementById('user_full_name');

        // Function to update the full name
        function updateFullName() {
            const firstName = firstNameField.value.trim();
            const lastName = lastNameField.value.trim();
            fullNameField.value = `${firstName} ${lastName}`;
        }

        // Add event listeners to update full name on blur (when the user leaves the field)
        firstNameField.addEventListener('blur', updateFullName);
        lastNameField.addEventListener('blur', updateFullName);

        // Initially update the full name on page load
        updateFullName();
    });
                </script>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Update Profile</h4>
                        </div>
                        <div class="card-body">
                            <h5>Personal Info</h5>
                            <div class="basic-form">
                                <div class="row">
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">First Name</label>
                                        <input type="text" class="form-control" name="first_name" id="first_name" placeholder="Enter your first name" value="{{ request.user.first_name }}" required>
                                    </div>
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Last Name</label>
                                        <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Enter your last name" value="{{ request.user.last_name }}" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Full Name</label>
                                        <input type="text" class="form-control" name="user_full_name" id="user_full_name" placeholder="Enter your full name" value="{{ request.user.user_full_name }}" required readonly>
                                    </div>
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">E-mail</label>
                                        <input type="email" class="form-control" name="email" id="email" placeholder="Enter your email" value="{{ request.user.email }}" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Mobile No</label>
                                        <input type="text" class="form-control" name="mobile" id="mobile" placeholder="Enter your mobile number" pattern="\d{10}" maxlength="10" minlength="10" inputmode="numeric" value="{{ request.user.mobile }}" required>
                                        <small class="form-text text-muted">Must be a 10-digit number.</small>
                                    </div>
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Whatsapp No</label>
                                        <input type="text" class="form-control" name="whatsappno" id="whatsappno" placeholder="Enter your WhatsApp number" pattern="\d{10}" maxlength="10" minlength="10" inputmode="numeric" value="{{ request.user.whatsappno }}" required>
                                        <small class="form-text text-muted">Must be a 10-digit number.</small>
                                    </div>
                                </div>
                                <div class="mb-3 col-md-6">
                                    {% if request.user.profile_pic %}
                                        <img src="{{ request.user.profile_pic.url }}" alt="Profile Picture" style="max-width: 150px; max-height: 150px; display: block; margin-bottom: 10px;">
                                    {% endif %}
                                    <label class="form-control-label">Profile Picture</label>
                                    <input type="file" id="profile_pic" name="profile_pic" class="form-control" {% if not request.user.profile_pic %} required {% endif %}>
                                </div>
                            </div>
                            {% if not request.user.profile_updated %}
                            
                            <h5>First Login Password Change</h5>
                            <div class="basic-form">
                                <div class="row">
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Old Password</label>
                                        <input type="password" class="form-control" name="old_password" id="old_password" placeholder="Enter your old password" required>
                                        <small id="old-password-error" class="form-text text-danger"></small>
                                    </div>
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">New Password</label>
                                        <input type="password" class="form-control" name="new_password" id="new_password" placeholder="Enter your new password" required>
                                    </div>
                                    <div class="mb-3 col-md-6">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" name="confirm_password" id="confirm_password" placeholder="Confirm your new password" required>
                                        <small id="password-match-error" class="form-text text-danger"></small>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="row">
                                    <div class="mb-3 col-md-6">
                                        <button type="submit" class="btn btn-primary">Update</button>
                                        <span>
                                            <a class="btn btn-info " href="/logout" role="button">Logout For Now</a>
                                        </span>

                                            
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const oldPasswordField = document.getElementById('old_password');
            const newPasswordField = document.getElementById('new_password');
            const confirmPasswordField = document.getElementById('confirm_password');
            const updateButton = document.getElementById('update-btn');
            const oldPasswordError = document.getElementById('old-password-error');
            const passwordMatchError = document.getElementById('password-match-error');

            // Function to check if new password and confirm password match
            function validatePasswordMatch() {
                if (newPasswordField.value !== confirmPasswordField.value) {
                    passwordMatchError.textContent = "Passwords do not match!";
                    return false;
                } else {
                    passwordMatchError.textContent = "";
                    return true;
                }
            }

            // Function to validate old password using AJAX
            async function validateOldPassword() {
    const oldPassword = document.getElementById('old_password').value;
    let isValid = false;

    if (oldPassword) {
        const url = `{% url 'validate_old_password' %}?old_password=${encodeURIComponent(oldPassword)}`;

        const response = await fetch(url, {
            method: "GET",
        });

        const data = await response.json();

        if (data.is_valid) {
            document.getElementById('old-password-error').textContent = "";
            isValid = true;
        } else {
            document.getElementById('old-password-error').textContent = "Old password is incorrect!";
            isValid = false;
        }
    }

    return isValid;
}

            // Validate old password on blur
            oldPasswordField.addEventListener('blur', async function () {
                await validateOldPassword();
            });

            // Validate new and confirm password match on blur
            confirmPasswordField.addEventListener('blur', validatePasswordMatch);

            // Handle form submission
            document.getElementById('profile-update-form').addEventListener('submit', async function (event) {
                const isOldPasswordValid = await validateOldPassword();
                const isPasswordMatchValid = validatePasswordMatch();

                if (!isOldPasswordValid || !isPasswordMatchValid) {
                    event.preventDefault(); // Prevent form submission if validation fails
                }
            });
        });
    </script>
    <!-- Required vendors -->
    <script src="/static/get/vendor/global/global.min.js"></script>
    <script src="/static/get/vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="/static/get/vendor/jquery-nice-select/js/jquery.nice-select.min.js"></script>
    <!-- Apex Chart -->
    <script src="/static/get/vendor/apexchart/apexchart.js"></script>
    <script src="/static/get/vendor/bootstrap-datetimepicker/js/moment.js"></script>
    <script src="/static/get/vendor/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <!-- Dashboard 1 -->
    <script src="/static/get/js/dashboard/dashboard-1.js"></script>
    <script src="/static/get/js/custom.js"></script>
    <script src="/static/get/js/dlabnav-init.js"></script>
    <script src="/static/get/js/demo.js"></script>
    <script>
		$(function () {
			$('#datetimepicker').datetimepicker({
				inline: true,
			});
		});
		
		$(document).ready(function(){
			$(".booking-calender .fa.fa-clock-o").removeClass(this);
			$(".booking-calender .fa.fa-clock-o").addClass('fa-clock');
		});
    </script>
</body>
</html>